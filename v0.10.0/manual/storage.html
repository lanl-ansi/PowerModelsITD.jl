<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Storage · PowerModelsITD.jl</title><meta name="title" content="Storage · PowerModelsITD.jl"/><meta property="og:title" content="Storage · PowerModelsITD.jl"/><meta property="twitter:title" content="Storage · PowerModelsITD.jl"/><meta name="description" content="Documentation for PowerModelsITD.jl."/><meta property="og:description" content="Documentation for PowerModelsITD.jl."/><meta property="twitter:description" content="Documentation for PowerModelsITD.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../index.html"><img src="../assets/logo.svg" alt="PowerModelsITD.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../index.html">PowerModelsITD.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Introduction</a></li><li><a class="tocitem" href="../installation.html">Installation Guide</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">Manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="quickguide.html">Getting Started</a></li><li><a class="tocitem" href="fileformat.html">File Formats</a></li><li><a class="tocitem" href="formulations.html">Formulations</a></li><li class="is-active"><a class="tocitem" href="storage.html">Storage</a><ul class="internal"><li><a class="tocitem" href="#TL;DR"><span>TL;DR</span></a></li><li><a class="tocitem" href="#Default-Costs-and-Units"><span>Default Costs and Units</span></a></li><li><a class="tocitem" href="#Running-Integrated-Transmission-Distribution-Optimal-Power-Flow-with-Storage-Costs"><span>Running Integrated Transmission-Distribution Optimal Power Flow with Storage Costs</span></a></li><li><a class="tocitem" href="#Running-Integrated-Transmission-Distribution-Optimal-Power-Flow-with-Storage-Costs-Multinetwork"><span>Running Integrated Transmission-Distribution Optimal Power Flow with Storage Costs Multinetwork</span></a></li><li><a class="tocitem" href="#How-are-the-Storage-Devices-Modeled?"><span>How are the Storage Devices Modeled?</span></a></li><li><a class="tocitem" href="#What-is-the-Cost-(Objective)-Function?"><span>What is the Cost (Objective) Function?</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../tutorials/BeginnersGuide.html">Beginners Guide</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">API Reference</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../reference/base.html">Base</a></li><li><a class="tocitem" href="../reference/data_models.html">Data Models</a></li><li><a class="tocitem" href="../reference/formulations.html">Formulations</a></li><li><a class="tocitem" href="../reference/problems.html">Problems</a></li><li><a class="tocitem" href="../reference/variables.html">Variables</a></li><li><a class="tocitem" href="../reference/constraints.html">Constraints</a></li><li><a class="tocitem" href="../reference/objectives.html">Objectives</a></li><li><a class="tocitem" href="../reference/constants.html">Constants</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Developer Docs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../developer/contributing.html">Contributing</a></li><li><a class="tocitem" href="../developer/style.html">Style Guide</a></li><li><a class="tocitem" href="../developer/roadmap.html">Roadmap</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href="storage.html">Storage</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="storage.html">Storage</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/lanl-ansi/PowerModelsITD.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/lanl-ansi/PowerModelsITD.jl/blob/main/docs/src/manual/storage.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Quick-Guide-on-Storage-(with-Costs)-Problem-Specification"><a class="docs-heading-anchor" href="#Quick-Guide-on-Storage-(with-Costs)-Problem-Specification">Quick Guide on Storage (with Costs) Problem Specification</a><a id="Quick-Guide-on-Storage-(with-Costs)-Problem-Specification-1"></a><a class="docs-heading-anchor-permalink" href="#Quick-Guide-on-Storage-(with-Costs)-Problem-Specification" title="Permalink"></a></h1><p>In this guide, we will discuss the differences between the two problem specifications currently available in <code>PowermodelsITD</code> that consider <code>storage devices</code> when performing OPF.</p><h2 id="TL;DR"><a class="docs-heading-anchor" href="#TL;DR">TL;DR</a><a id="TL;DR-1"></a><a class="docs-heading-anchor-permalink" href="#TL;DR" title="Permalink"></a></h2><ul><li><p><code>solve_opfitd(...)</code>: considers the operation (charge and discharge) of storage devices at both transmission and distribution system(s), but, no cost is added to the objective cost function. In other words, cycling/using the storage devices is a <code>free</code> operation.</p></li><li><p><code>solve_opfitd_storage(...)</code>: considers the operation (charge and discharge) of storage devices at both transmission and distribution system(s), and cost term(s) are added to the objective cost function. In other words, cycling/using the storage devices is <code>not free</code> and the specific cost of using the storage device is added to the cost function as <span>$sd \times cost$</span>, where <code>sd</code> is the amount of power discharged and <code>cost</code> is a scalar value in units <span>$</span>/kWh or <span>$</span>/pu.</p></li></ul><h2 id="Default-Costs-and-Units"><a class="docs-heading-anchor" href="#Default-Costs-and-Units">Default Costs and Units</a><a id="Default-Costs-and-Units-1"></a><a class="docs-heading-anchor-permalink" href="#Default-Costs-and-Units" title="Permalink"></a></h2><p>By default, the costs of the storage devices are calculated based on the references shown below. However, users are <em>encouraged</em> to assign their own costs after parsing files.</p><ul><li>Transmission cost must be in <span>$</span>/pu units.</li></ul><p>(e.g., transformation from <span>$</span>/MWh -&gt; <span>$</span>/pu: 200 <span>$</span>/MWh x 100 MVA base/1 pu = 20,000 <span>$</span>/pu)</p><ul><li>Distribution cost must be in <span>$</span>/kWh units.</li><li>Default costs of storage devices (in <span>$</span>/kWh) are computed based on Eq. (23) from this <a href="https://ieeexplore.ieee.org/document/8805394">publication</a>.</li><li>The total cost of the storage system, <span>$C_{total}^{ES}$</span>, is estimated based on NREL data obtained from this <a href="https://atb.nrel.gov/electricity/2021/residential_battery_storage">resource</a>.</li></ul><p class="math-container">\[\begin{align}
%
cost =  c_{\epsilon, \varepsilon} = \dfrac{C_{total}^{ES}}{Cyc\cdot {E_{_{ES}}^{max}}\cdot DoD\cdot \eta_{r}},
%
\end{align}\]</p><h2 id="Running-Integrated-Transmission-Distribution-Optimal-Power-Flow-with-Storage-Costs"><a class="docs-heading-anchor" href="#Running-Integrated-Transmission-Distribution-Optimal-Power-Flow-with-Storage-Costs">Running Integrated Transmission-Distribution Optimal Power Flow with Storage Costs</a><a id="Running-Integrated-Transmission-Distribution-Optimal-Power-Flow-with-Storage-Costs-1"></a><a class="docs-heading-anchor-permalink" href="#Running-Integrated-Transmission-Distribution-Optimal-Power-Flow-with-Storage-Costs" title="Permalink"></a></h2><p>The snippet below shows how to run a steady-state Integrated Transmission-Distribution (ITD) AC Optimal Power Flow with storage costs. All of these files can be found in <code>test</code> folder of the repository.</p><pre><code class="language-julia hljs">using PowerModelsITD
using Ipopt

pm_file = &quot;case5_withload.m&quot;
pmd_file = &quot;case3_balanced_withBattery.dss&quot;
pmitd_file = &quot;case5_case3_bal_battery.json&quot;
pmitd_type = NLPowerModelITD{ACPPowerModel, ACPUPowerModel}
pmitd_data = parse_files(pm_file, pmd_file, pmitd_file)

# cost to assign to energy storage
# Units $/kWh
strg_cost = 0.025

# add cost to storages in PMD
for (st_name, st_data) in pmitd_data[&quot;it&quot;][&quot;pmd&quot;][&quot;storage&quot;]
    st_data[&quot;cost&quot;] = strg_cost
end

# solve optimization with storage cost problem
pmitd_result_strg = solve_opfitd_storage(pmitd_data, pmitd_type, Ipopt.Optimizer)
</code></pre><h2 id="Running-Integrated-Transmission-Distribution-Optimal-Power-Flow-with-Storage-Costs-Multinetwork"><a class="docs-heading-anchor" href="#Running-Integrated-Transmission-Distribution-Optimal-Power-Flow-with-Storage-Costs-Multinetwork">Running Integrated Transmission-Distribution Optimal Power Flow with Storage Costs Multinetwork</a><a id="Running-Integrated-Transmission-Distribution-Optimal-Power-Flow-with-Storage-Costs-Multinetwork-1"></a><a class="docs-heading-anchor-permalink" href="#Running-Integrated-Transmission-Distribution-Optimal-Power-Flow-with-Storage-Costs-Multinetwork" title="Permalink"></a></h2><p>Running a multinetwork (i.e., multi-timestep) is also very simple. Only slight changes are required (assuming multinetwork data exists in the distribution files) as seen in the snippet shown below.</p><pre><code class="language-julia hljs">using PowerModelsITD
using Ipopt

pm_file = &quot;case5_withload.m&quot;
pmd_file = &quot;case3_balanced_withBattery_mn_diff.dss&quot;
pmitd_file = &quot;case5_case3_bal_battery_mn.json&quot;
pmitd_type = NLPowerModelITD{ACPPowerModel, ACPUPowerModel}
pmitd_data = parse_files(pm_file, pmd_file, pmitd_file; multinetwork=true)

# cost to assign to energy storage
# Units $/kWh
strg_cost = 0.0025

# add cost to storages in PMD
for (nw_id, nw_data) in pmitd_data[&quot;it&quot;][&quot;pmd&quot;][&quot;nw&quot;]
    for (st_name, st_data) in nw_data[&quot;storage&quot;]
        st_data[&quot;cost&quot;] = strg_cost
    end
end

pmitd_result_strg = solve_mn_opfitd_storage(pmitd_data, pmitd_type, Ipopt.Optimizer)
</code></pre><h2 id="How-are-the-Storage-Devices-Modeled?"><a class="docs-heading-anchor" href="#How-are-the-Storage-Devices-Modeled?">How are the Storage Devices Modeled?</a><a id="How-are-the-Storage-Devices-Modeled?-1"></a><a class="docs-heading-anchor-permalink" href="#How-are-the-Storage-Devices-Modeled?" title="Permalink"></a></h2><p>The storage mathematical model (for both transmission and distribution system(s)) are based on the model shown <a href="https://lanl-ansi.github.io/PowerModels.jl/stable/storage/">here</a>. Given the storage data model and two sequential time points <span>$s$</span> and <span>$t$</span>, the storage component&#39;s mathematical model is given by,</p><p class="math-container">\[\begin{align}
%
\mbox{data: } &amp; \nonumber \\
&amp; e^u \mbox{ - energy rating} \nonumber \\
&amp; sc^u \mbox{ - charge rating} \nonumber \\
&amp; sd^u \mbox{ - discharge rating} \nonumber \\
&amp; \eta^c \mbox{ - charge efficiency} \nonumber \\
&amp; \eta^d \mbox{ - discharge efficiency} \nonumber \\
&amp; te \mbox{ - time elapsed} \nonumber \\
&amp; S^l \mbox{ - power losses} \nonumber \\
&amp; Z \mbox{ - injection impedance} \nonumber \\
&amp; q^l, q^u  \mbox{ - reactive power injection limits} \nonumber \\
&amp; s^u \mbox{ - thermal injection limit} \nonumber \\
&amp; i^u \mbox{ - current injection limit} \nonumber \\
%
\mbox{variables: } &amp; \nonumber \\
&amp; e_i \in (0, e^u) \mbox{ - storage energy at time $i$} \label{var_strg_energy} \\
&amp; sc_i \in (0, sc^u) \mbox{ - charge amount at time $i$} \label{var_strg_charge} \\
&amp; sd_i \in (0, sd^u) \mbox{ - discharge amount at time $i$} \label{var_strg_discharge} \\
&amp; sqc_i \mbox{ - reactive power slack at time $i$} \label{var_strg_qslack} \\
&amp; S_i \mbox{ - complex bus power injection at time $i$} \label{var_strg_power} \\
&amp; I_i \mbox{ - complex bus current injection at time $i$} \label{var_strg_current} \\
%
\mbox{subject to: } &amp; \nonumber \\
&amp; e_t - e_s = te \left(\eta^c sc_t - \frac{sd_t}{\eta^d} \right) \label{eq_strg_energy} \\
&amp; sc_t \cdot sd_t = 0 \label{eq_strg_compl} \\
&amp; S_t + (sd_t - sc_t) = j \cdot sqc_t + S^l + Z |I_t|^2 \label{eq_strg_loss} \\
&amp; q^l \leq \Im(S_t) \leq q^u \label{eq_strg_q_limit} \\
&amp; |S_t| \leq s^u \label{eq_strg_thermal_limit} \\
&amp; |I_t| \leq i^u \label{eq_strg_current_limit}
\end{align}\]</p><h2 id="What-is-the-Cost-(Objective)-Function?"><a class="docs-heading-anchor" href="#What-is-the-Cost-(Objective)-Function?">What is the Cost (Objective) Function?</a><a id="What-is-the-Cost-(Objective)-Function?-1"></a><a class="docs-heading-anchor-permalink" href="#What-is-the-Cost-(Objective)-Function?" title="Permalink"></a></h2><p>The cost (objective) function of the <code>solve_opfitd_storage(...)</code> and <code>solve_mn_opfitd_storage(...)</code> is based on the mathematical model:</p><p class="math-container">\[\begin{align}
\begin{split}
   \text{min} &amp;\bigg(\sum_{k \in G^{^\mathcal{T}}} c_{2k}(P_{g,k}^{\mathcal{T}})^2 + c_{1k}(P_{g,k}^{\mathcal{T}}) + c_{0k} \bigg) +\\
    &amp;\bigg(\sum_{\epsilon \in E^{^\mathcal{T}}} c_{\epsilon}(sd_{\epsilon}^{\mathcal{T}})\bigg) +\\
    &amp;\bigg(\sum_{m \in G^{^\mathcal{D}}} c_{2m}(\sum_{\varphi \in \Phi} P_{g,m}^{\mathcal{D},\varphi})^2 + c_{1m}(\sum_{\varphi \in \Phi} P_{g,m}^{\mathcal{D},\varphi}) + c_{0m} \bigg) +\\
    &amp;\bigg(\sum_{\varepsilon \in E^{^\mathcal{D}}} c_{\varepsilon}(sd_{\varepsilon}^{\mathcal{D}})\bigg)
\end{split}
\end{align}\]</p><p>As observed, the costs of discharging the storage devices for both Transmission and Distribution system(s) are added the cost function of the OPFITD. This means that storage devices will only discharge power to the grid when the cost of <code>charging</code> + <code>discharging</code> energy is less than the cost of <em>not</em> using (cycling) the storage device.</p><p>This cost function only cosiders cost as a factor for determining when to use the storage devices, however, it is important to note that users are encouraged to create their own cost functions that consider other factors (e.g., voltage deviations) that will make the storage devices operate more often, as needed.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="formulations.html">« Formulations</a><a class="docs-footer-nextpage" href="../tutorials/BeginnersGuide.html">Beginners Guide »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.2 on <span class="colophon-date" title="Thursday 19 September 2024 19:09">Thursday 19 September 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
